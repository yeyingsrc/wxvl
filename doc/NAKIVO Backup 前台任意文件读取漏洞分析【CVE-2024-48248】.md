#  NAKIVO Backup 前台任意文件读取漏洞分析【CVE-2024-48248】   
原创 Mstir  星悦安全   2025-03-04 05:02  
  
![图片](https://mmbiz.qpic.cn/sz_mmbiz_jpg/lSQtsngIibibSOeF8DNKNAC3a6kgvhmWqvoQdibCCk028HCpd5q1pEeFjIhicyia0IcY7f2G9fpqaUm6ATDQuZZ05yw/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp "")  
  
点击上方  
蓝字  
关注我们 并设为  
星标  
## 0x00 前言  
  
**NAKIVO Backup & Replication 是一款专注于虚拟化、云端及混合环境的备份与灾难恢复的解决方案，高级云集成，内置 VMware 监控功能，可实时监控 CPU、内存和磁盘的使用情况，基于 Web 的直观界面，可从任何位置和任何设备访问解决方案，基于策略的自动化，通过自动执行备份和 在与策略规则匹配的计算机上复制。**  
  
****  
**Fofa指纹 : app="NAKIVO-Backup-Replication"**  
  
****  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/uicic8KPZnD5ebt4r9tZAUTv5NPn35kAhBm8j3eHU52DFybss2Uzr18R3KMRP0axVn7whXk1rWccCWuUx48fLzjg/640?wx_fmt=png&from=appmsg "")  
  
![image.png](https://mmbiz.qpic.cn/sz_mmbiz_jpg/uicic8KPZnD5ebt4r9tZAUTv5NPn35kAhBySViaV8GlG4cuX3Z2axNv2rFCKp9e3Dsu7IpW0lPKaicfJGO90hSOdCw/640?wx_fmt=other&from=appmsg "")  
  
框架:Tomcat springframework  
## 0x01 漏洞研究&复现  
想要研究该设备，我们需要下载 V10.11.3 的版本，但在官网没有找到Windows程序的安装界面了，但是能找到OVA 虚拟机文件的下载链接，遂下载一下进行研究（需魔法，不然下很慢）.https://nbr-va.s3-us-west-2.amazonaws.com/NAKIVO_Backup_Replication_VA_v10.11.3_Full_Solution_TRIAL.ova  
**.OVA文件下下来之后，直接拖进VMware 虚拟机中即可直接运行，其描述中带了虚拟机主机账号及密码.**  
  
****```
Ubuntu 22.04 Server VA with NAKIVO Backup and Replication 10.11 preinstalledVA login: nkvuserVA password: QExS-6b%3D
```  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/uicic8KPZnD5ebt4r9tZAUTv5NPn35kAhBT7rcTZd26MspibZAfO0ZCDj1b1SVHD7Vuic5ygNicibXwHUF0BqPoJV58Q/640?wx_fmt=webp&from=appmsg "")  
  
根据一些路由分析，我们找到了如下代码```
@Service
@RemotingApiAction(STPreLoadManagement.class)public class STPreLoadFacade  implements STPreLoadManagement{

[..Truncated..]

@RemotingApiMethod
public byte[] getImageByPath(String path) throws MspManagementException {
  try {
    return this.brandingService.getImageByPath(path);
  } catch (Throwable t) {
    throw new MspManagementException(t);
  } 

```  
  
  
其通过传参method = getImageByPath 来进入到该方法中，然后进入到getImageByPath 方法之中，我们继续看一下这个方法  
  
```
public byte[] getImageByPath(String path) throws IOException {
  String newPath = path.replace("/c", "userdata");
  File file = new File(newPath);
  return FileUtils.readFileToByteArray(file);
}

```  
  
  
该方法使用 getImageByPath 采用参数 path 并将该路径将文件读取到字节数组  
  
Payload:  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/uicic8KPZnD5ebt4r9tZAUTv5NPn35kAhBgb59Xwq4MTibdueAsgia7GTcWelGFwOUfMHWiblezg0EYlicVQSh5Dx84A/640?wx_fmt=png&from=appmsg "")  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/uicic8KPZnD5ebt4r9tZAUTv5NPn35kAhBwsNNJKzjibHduYvY5cmxML5Q8gctsgz6XNSnDwYaecHnj7GRfrF3xwQ/640?wx_fmt=png&from=appmsg "")  
  
利用脚本:  
  
![](https://mmbiz.qpic.cn/sz_mmbiz_png/uicic8KPZnD5ebt4r9tZAUTv5NPn35kAhBibYfUUXxic6JmNpvdZNyXGOMkasmgduRGbPqziceu3d07YWibeT4tficVZA/640?wx_fmt=png&from=appmsg "")  
## 0x02 关注公众号  
  
**标签:代码审计，0day，渗透测试，系统，通用，0day，闲鱼，转转**  
  
**POC关注公众号发送 250304 获取!**  
  
****  
  
****  
**开了个星悦安全公开交流6群，🈲发公众号，纯粹研究技术，进了其他公开群的不要重复进了.**  
  
![图片](https://mmbiz.qpic.cn/sz_mmbiz_jpg/uicic8KPZnD5cW9NgUnN7cGGZxZqlp453aOPiaffwajFmfm8icbia6ZoHFD868yp9cnJAibVsuqiaxib7X3ZoOeQ1hpGGQ/640?wx_fmt=jpeg&from=appmsg "")  
  
**免责声明:文章中涉及的程序(方法)可能带有攻击性，仅供安全研究与教学之用，读者将其信息做其他用途，由读者承担全部法律及连带责任，文章作者和本公众号不承担任何法律及连带责任，望周知！！!**  
  
